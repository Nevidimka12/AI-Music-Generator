import mingus.core.chords as chords 

from librosa import note_to_midi
import pygame.midi
import time

def decompose_chord(chord):
  if chord != 'N': # 'N' means no chord is played
    return chords.from_shorthand(chord) # transforming string chord into array of string notes
  else:
    return []

def play_chords(chord_data):
    pygame.init()
    pygame.midi.init()
    player = pygame.midi.Output(0)

    timestamp_prev = 0 # timestamp of previous chord
    for chord, timestamp in chord_data:

        decomposed_chord = decompose_chord(chord)

        for note in decomposed_chord:
            oct_note = note + '3'
            midi_note = note_to_midi(oct_note)
            player.note_on(midi_note, 127)

        duration = timestamp-timestamp_prev
        time.sleep(duration)

        for note in decomposed_chord:
            midi_note = note_to_midi(note)
            player.note_off(midi_note, 127)

        timestamp_prev = timestamp



    del player
    pygame.midi.quit()



chord_data = [('N', 0.371519274), ('G', 0.464399092), ('Eb7/G', 7.24462585), ('Gm7', 8.080544217), ('Dm7', 13.096054421), ('Em7', 14.117732426), ('C', 15.13941043), ('Dm7', 16.532607709), ('Em7', 18.111564625), ('Am7', 19.13324263), ('Cmaj7', 20.062040816), ('Fmaj7', 21.548117913), ('Cmaj7', 24.055873015), ('Dm7', 26.37786848), ('Em7', 27.120907029), ('C', 28.142585034), ('Dm', 29.071383219), ('Em7', 31.114739229), ('Cmaj7', 32.32217687), ('B/F#', 33.901133786), ('G/F', 34.644172335), ('Fmaj7', 36.687528344), ('Cmaj7', 40.402721088), ('Dm7', 42.724716553), ('Ebm7', 43.56063492), ('Cmaj7', 44.396553287), ('Em7', 48.390385487), ('F/A', 49.876462585), ('Eb', 51.176780045), ('C/D', 51.641179138), ('Dm7', 52.477097505), ('G6', 53.591655328), ('F#maj7', 56.563809523), ('Cmaj7', 57.399727891), ('E7', 60.371882086), ('Am7', 61.39356009), ('Ebdim', 62.972517006), ('G/D', 64.551473922), ('C6', 65.944671201), ('Gm7', 67.616507936), ('G7', 69.474104308), ('C/D', 71.238820861), ('G7/B', 74.396734693), ('Em7', 76.62585034), ('Cmaj7', 78.483446712), ('Fmaj7', 79.969523809), ('G6', 82.384399092), ('C', 84.056235827), ('Dm', 87.957188208), ('Em7', 89.536145124), ('Cmaj7', 91.11510204), ('Fmaj7', 93.065578231), ('C/D', 93.80861678), ('G6', 95.387573696), ('C6', 97.05941043), ('Eb', 100.217324263), ('Ddim', 105.047074829), ('G7', 105.975873015), ('F6', 106.811791383), ('Abmaj7', 109.133786848), ('C/D', 110.062585034), ('G', 111.548662131), ('F#', 113.127619047), ('Bb7', 118.050249433), ('Ebm', 119.629206349), ('Bb', 124.458956916), ('Eb', 126.223673469), ('Fm7', 130.217505668), ('Ddim', 131.146303854), ('Gm7', 131.796462585), ('Cm7', 132.818140589), ('Abmaj7', 135.047256235), ('Gm7', 135.883174603), ('C', 137.555011337), ('Fm7', 139.133968253), ('Bb6', 140.71292517), ('Eb7', 142.384761904), ('Ab', 144.056598639), ('Ebdim', 144.799637188), ('Bb', 145.72843537400001), ('E', 147.400272108), ('Bb6', 148.886349206), ('Ab7', 150.465306122), ('Ebmaj7', 151.951383219), ('C7', 153.90185941), ('F', 155.295056689), ('Gm7', 156.316734693), ('F#7', 159.381768707), ('F7', 160.310566893), ('Bb6', 160.960725623), ('Ebmaj7', 161.982403628), ('Bb', 163.375600907), ('Ebmaj7', 165.047437641), ('Gm7', 166.626394557), ('C7', 167.555192743), ('F/C', 168.298231292), ('Bb', 169.970068027), ('Gm7', 171.456145124), ('F#', 172.663582766), ('Fm7', 173.313741496), ('Ebmaj7', 178.143492063), ('Dm7b5/C', 180.186848072), ('Bb', 182.787482993), ('Gm', 184.737959183), ('F#6', 185.388117913), ('F', 186.224036281), ('Bbm', 187.059954648), ('Ebmaj7', 187.802993197), ('Ebm', 190.032108843), ('Bb6', 191.332426303), ('F/Eb', 192.261224489), ('F#6', 194.490340136), ('Fm', 195.976417233), ('Gm7', 196.905215419), ('Caug', 199.598730158), ('Fm7', 200.899047619), ('Bb6', 202.478004535), ('F#7', 204.892879818), ('F7', 205.635918367), ('Ebmaj7', 206.378956916), ('Gm7b5/F', 208.143673469), ('Eb', 209.536870748), ('Fm7', 211.301587301), ('Gm7', 212.601904761), ('Abmaj7', 216.131337868), ('G', 218.63909297), ('Eb6', 220.218049886), ('Fm7', 224.211882086), ('Bb7/D', 225.23356009), ('Gm7', 225.790839002), ('C7', 231.549387755), ('Fm', 233.314104308), ('Bb6', 234.800181405), ('Cm', 236.564897959), ('F#maj7', 239.722811791), ('Emaj7', 241.394648526), ('Eb', 243.345124716), ('Ab', 247.524716553), ('Dm7b5', 249.475192743), ('G', 250.311111111), ('Cm7', 251.518548752), ('Am7b5', 253.469024943), ('Ab6', 254.490702947), ('Eb/Bb', 255.512380952), ('Bb', 261.642448979), ('N', 268.608435374)]
play_chords(chord_data)
